================================================================================
 BODY ESP - GEBRUIKSAANWIJZING
 Intelligente Biometric Stress Management Device
================================================================================

📅 Versie: 2.0 - ML Enhanced
🎯 Voor: Eindgebruikers
📍 Hardware: ESP32-2432S028R (CYD) + Sensors

================================================================================
 🚀 EERSTE GEBRUIK
================================================================================

OPSTARTEN:
1. Sluit alle sensoren aan (hartslag, temperatuur, GSR)
2. Zet Body ESP aan
3. Wacht tot WiFi verbonden is (zie IP adres op Serial Monitor)
4. Ga naar Menu → AI voor instellingen

BEGINNERS SETUP:
1. Menu → AI → "ML Eigenwil" → stel in op 20-30%
2. Menu → AI → Check andere sensoren instellingen
3. Klik "OPSLAAN"
4. Start eerste sessie via hoofdmenu

================================================================================
 🎛️ BEDIENING
================================================================================

HOOFDMENU:
- Klik scherm om menu te openen
- Kies gewenste modus (AI Training, Sensors, etc.)
- "TERUG" knop om terug te gaan

AI INSTELLINGEN (Menu → AI):
┌─────────────────────────────────────────────────┐
│ ML Eigenwil: [XX%]  [-] [+]  ← BELANGRIJKSTE   │
│ HR Laag:     [60]   [-] [+]                     │
│ HR Hoog:     [140]  [-] [+]                     │
│ Temp Max:    [38.5] [-] [+]                     │
│ GSR Max:     [800]  [-] [+]                     │
│                                                 │
│ [AI AAN/UIT] [OPSLAAN] [TERUG]                  │
└─────────────────────────────────────────────────┘

ML EIGENWIL UITLEG:
- 0%:   Alleen vaste regels, geen ML
- 30%:  ML geeft advies, regels beslissen (AANBEVOLEN)
- 60%:  ML en regels werken samen
- 100%: ML heeft volledige controle

================================================================================
 📊 TIJDENS GEBRUIK
================================================================================

STATUS INFORMATIE:
- Scherm toont huidige stress level (0-7)
- Biometric waarden worden real-time getoond
- ML beslissingen verschijnen in Serial Monitor

NORMAL WERKING:
1. Body ESP meet automatisch je biometrics
2. ML analyseert je stress patterns
3. Hardware past zich aan op basis van stress + ML autonomie
4. Sessie loopt tot je handmatig stopt (via menu of C-knop op Hoofd ESP)

VERWACHT GEDRAG:
- Lage stress → lagere intensiteit
- Hoge stress → ML past aan (afhankelijk van autonomie %)
- ML leert je patronen en wordt slimmer over tijd

================================================================================
 ⚠️  BELANGRIJKE KNOPPEN
================================================================================

C-KNOP (op Hoofd ESP nunchuk):
- Stopt/pauzeert de machine
- Altijd beschikbaar, ongeacht ML instellingen
- Gewoon normale stop/pauze functie

BOOT KNOP (FACTORY RESET):
- Houd 3 seconden ingedrukt = complete reset
- Wist alle ML data en instellingen
- Gebruik als je volledig opnieuw wilt beginnen
- WAARSCHUWING: Alle geleerde patronen worden gewist!

AUTOMATISCHE OPSLAG:
- ML Eigenwil wordt automatisch opgeslagen bij wijzigingen
- OPSLAAN knop bewaart alle andere AI instellingen (HR, Temp, GSR)
- Alle instellingen blijven na herstart behouden
- Geen handmatige actie nodig voor ML Eigenwil

================================================================================
 🔄 DAGELIJKS GEBRUIK
================================================================================

STARTEN:
1. Zorg dat sensoren goed contact maken met huid
2. Check batterij niveau
3. Start Body ESP
4. Begin sessie wanneer ready

OPTIMAAL RESULTAAT:
- Begin met lage ML Eigenwil (20-30%)
- Laat systeem een paar sessies leren
- Verhoog geleidelijk als je tevreden bent
- Monitor Serial output voor ML feedback

PROBLEMEN OPLOSSEN:
- Slechte sensordata? → Check sensor contact
- Te intense reacties? → Verlaag ML Eigenwil
- Systeem reageert niet? → C-knop indrukken
- Complete problemen? → Factory reset (Boot knop)

================================================================================
 📈 ML LEARNING PROCES
================================================================================

HOE ML LEERT:
- Verzamelt je biometric patronen tijdens sessies
- Onthoudt wanneer je stress hebt
- Leert welke intensiteiten goed werken
- Past beslissingen aan op basis van je reacties

TEKENEN DAT ML WERKT:
- Serial Monitor toont "ML Override" berichten
- Hardware reageert anders dan alleen op basis van regels
- Systeem anticipeert op je stress patterns
- Sessies voelen meer "gepersonaliseerd"

GEDULD HEBBEN:
- ML heeft 10+ sessies nodig voor goede patronen
- Elke sessie wordt het slimmer
- Slechte sessies? ML leert ook van fouten
- Factory reset wist alle progress!

================================================================================
 🛠️ ONDERHOUD
================================================================================

DAGELIJKS:
- Check sensor contacten
- Clean sensoren na gebruik
- Controleer batterij niveau

WEKELIJKS:
- Check Serial Monitor voor error meldingen
- Backup instellingen (noteer ML Eigenwil %)
- Test noodstop functionaliteit

MAANDELIJKS:
- Check firmware updates
- Analyseer ML learning progress via Serial
- Overweeg ML Eigenwil aanpassingen

================================================================================
 🔗 RELATIE MET HOOFD ESP
================================================================================

Body ESP werkt samen met de Hoofd ESP in een meester-slaaf architectuur:

HOOFD ESP (Master Device):
- Beheert de hoofdmachine (sleeve, vacuum pomp, lube systeem)
- Stuurt de animatie en fysieke hardware aan
- Ontvangt nunchuk input van gebruiker
- Heeft het hoofdscherm met interface

BODY ESP (AI Advisor):
- Monitort jouw biometrics (hartslag, temperatuur, GSR)
- Analyseert stress patronen met machine learning
- Stuurt "aanbevelingen" naar Hoofd ESP
- Heeft GEEN directe hardware controle

COMMUNICATIE (ESP-NOW):
Body ESP → Hoofd ESP: "AI_OVERRIDE" commando's
- newTrust: Factor 0.0-1.0 (bijv. 0.8 = verlaag naar 80%)
- newSleeve: Factor 0.0-1.0 (bijv. 1.0 = geen wijziging)
- overruleActive: true/false (AI actief of passief)

Hoofd ESP → Body ESP: Status updates
- Huidige snelheden, vacuum levels, pause status
- Sleeve positie, lube cyclus timing
- Emergency stop status

ML EIGENWIL CONTROLE:
- 0%: Hoofd ESP negeert alle Body ESP aanbevelingen
- 50%: Hoofd ESP past 50% van de AI aanbevelingen toe
- 100%: Hoofd ESP volgt Body ESP volledig (gevaarlijk!)

================================================================================
 🎮 MULTIFUNPLAYER INTEGRATIE
================================================================================

Body ESP kan ook werken met MultiFunPlayer voor VR funscript ondersteuning:

WAT IS MULTIFUNPLAYER?
MultiFunPlayer is een programma dat:
- .funscript bestanden kan afspelen
- Synchroniseert met video's (inclusief VR)
- WebSocket verbindingen ondersteunt
- Real-time hardware aansturing biedt

FUNSCRIPT BESTANDEN:
.funscript files bevatten:
- Timestamp data (wanneer actie moet gebeuren)
- Position data (0-100, waar sleeve moet zijn)
- Speed data (hoe snel beweging moet zijn)

VOORBEELD .funscript data:
```json
{
  "actions": [
    {"at": 1000, "pos": 10},   // 1 seconde: positie 10%
    {"at": 2000, "pos": 90},   // 2 seconden: positie 90%
    {"at": 3000, "pos": 20}    // 3 seconden: positie 20%
  ]
}
```

BODY ESP + MULTIFUNPLAYER WORKFLOW:
1. MultiFunPlayer laadt .funscript bestand
2. MultiFunPlayer speelt video af (VR bril)
3. MultiFunPlayer stuurt funscript data naar Body ESP via WebSocket
4. Body ESP ontvangt: position, speed, timestamp
5. Body ESP ML analyseert: "Is deze actie veilig voor gebruiker?"
6. Als ML Eigenwil > 0%: Body ESP past actie aan
7. Body ESP stuurt aangepaste commando naar Hoofd ESP
8. Hoofd ESP voert finale actie uit op hardware

VR BRIL COMBINATIE:
👓 VR Bril toont video
🎮 MultiFunPlayer synchroniseert funscript
🧠 Body ESP analyseert stress/veiligheid
⚙️ Hoofd ESP controleert hardware

NETWERK SETUP:
1. PC (MultiFunPlayer) → WiFi → Body ESP
2. Body ESP → ESP-NOW → Hoofd ESP
3. Hoofd ESP → ESP-NOW → Pomp Unit (vacuum/lube)

WEBSOCKET PROTOCOL:
MultiFunPlayer → Body ESP:
```json
{
  "type": "action",
  "timestamp": 12500,
  "position": 75,
  "speed": 80
}
```

ML VERWERKING:
Body ESP ontvangt funscript actie en:
- Checkt huidige stress level (0-7)
- Als stress < 4: Volg funscript normaal
- Als stress 4-6: Verlaag intensiteit
- Als stress 7: Emergency slow down of stop

ML AUTONOMIE IN VR:
- 0%: Pure funscript playback (geen ML)
- 30%: ML past extreme acties aan
- 60%: ML optimaliseert voor comfort
- 100%: ML heeft volledige controle (kan script negeren)

VOORBEELD SCENARIO:
```
Funscript zegt: Position 90, Speed 100
ML detecteert: Stress level 5 (hoog)
ML beslissing: Position 60, Speed 70 (veiliger)
Resultaat: Zachter dan script, maar wel gesynchroniseerd
```

VOORDELEN VR + ML:
✅ Persoonlijke aanpassingen tijdens VR sessie
✅ Automatische veiligheidscontrole
✅ Stress-responsive intensiteit
✅ Geen handmatige tussenkomst nodig
✅ Perfect gesynchroniseerd met video

CONFIGURATIE:
1. Install MultiFunPlayer op PC
2. Zoek je PC IP adres (Windows: cmd → ipconfig)
3. Configureer MultiFunPlayer:
   - Output Settings → Enable WebSocket Server
   - Poort: 8080 (of andere vrije poort)
   - Bind adres: 0.0.0.0 (luistert op alle interfaces)
4. Configureer Body ESP code:
   ```cpp
   String pcIP = "192.168.1.100";  // ← JE PC IP ADRES
   uint16_t port = 8080;            // ← MULTIFUNPLAYER POORT
   mfpClient.begin(pcIP, port, "/");
   ```
5. Zorg dat Body ESP en PC op hetzelfde WiFi netwerk zitten
6. Load .funscript file in MultiFunPlayer
7. Set ML Eigenwil op gewenst niveau (20-50% aanbevolen)
8. Start VR video + funscript playback
9. Body ESP past automatisch aan op basis van jouw stress

TEST VERBINDING:
- Body ESP Serial Monitor toont: "[MFP] Connected to MultiFunPlayer"
- MultiFunPlayer toont verbonden device: "Body_ESP_ML"
- Bij problemen: check IP adres, poort, WiFi netwerk

================================================================================
 📞 HULP NODIG?
================================================================================

VEELVOORKOMENDE PROBLEMEN:

🔴 "Hardware reageert niet"
→ Check C-knop (noodstop actief?)
→ Check power verbindingen
→ Herstart Body ESP

🔴 "Sensoren geven rare waarden"
→ Check sensor contact met huid
→ Clean sensoren
→ Check bekabeling

🔴 "ML doet rare dingen"
→ Verlaag ML Eigenwil naar 20%
→ Check Serial output voor details
→ Overweeg factory reset als het heel erg is

🔴 "Systeem crasht"
→ Check Serial Monitor voor error meldingen
→ Factory reset als laatste optie
→ Check firmware versie

SERIAL MONITOR:
- Gebruik altijd Serial Monitor (115200 baud)
- Geeft gedetailleerde info over ML beslissingen
- Toont error meldingen en debug info
- Onmisbaar voor troubleshooting

================================================================================
 🎉 VEEL PLEZIER!
================================================================================

Je Body ESP is een geavanceerd, lerend systeem dat steeds beter wordt 
naarmate je het meer gebruikt. Begin voorzichtig, laat het leren, en 
geniet van een steeds meer gepersonaliseerde ervaring!

Met ML Eigenwil heb je volledige controle over hoeveel vrijheid je het 
systeem geeft. Van strikte regels (0%) tot volledige AI autonomie (100%).

De toekomst van biometric-responsive hardware! 🚀🤖

================================================================================