SOLACE PRO 2 TEST - COMPLETE HANDLEIDING & DOCUMENTATIE
======================================================
Laatste update: 2025-09-17 16:25 UTC
Hardware: LilyGO TTGO T-Display V1.1 ESP32
Project: Lovense Solace Pro 2 BLE Test Interface

OVERZICHT
=========
Deze code implementeert een complete test interface voor de Lovense Solace Pro 2 via Bluetooth Low Energy.
De code gebruikt het reverse-engineered Lovense BLE protocol gebaseerd op community documentatie en biedt
zowel een visuele interface op het TTGO display als uitgebreide serial monitor commando's.

HARDWARE VEREISTEN
==================
- LilyGO TTGO T-Display V1.1 ESP32 (1.14" 135x240 display)
- Nintendo Nunchuk (optioneel, voor realtime besturing)  
- Lovense Solace Pro 2 device
- Arduino IDE met ESP32 board support

VEREISTE LIBRARIES
==================
1. TFT_eSPI - Voor display besturing
2. NintendoExtensionCtrl - Voor Nunchuk support
3. NimBLE-Arduino - Voor Bluetooth Low Energy functionaliteit

Installatie NimBLE-Arduino:
- Open Arduino IDE
- Ga naar Tools > Manage Libraries
- Zoek naar "NimBLE-Arduino"
- Installeer de nieuwste versie

NIEUWE FUNCTIONALITEIT (TOEGEVOEGD)
===================================

1. ECHTE BLE IMPLEMENTATIE
--------------------------
✅ NimBLE-Arduino library integratie
✅ Lovense BLE protocol implementatie (reverse-engineered via community)
✅ Automatische device scanning en herkenning (LVS- devices, Lovense UUIDs)
✅ Proper connection management met error handling
✅ Real-time Lovense command protocol (position 0-100, oscillation 0-20)

2. UITGEBREIDE SERIAL COMMAND INTERFACE
---------------------------------------
Complete set van commando's voor testing via Serial Monitor:

BLE COMMANDS:
-------------
scan              - Scan for Lovense devices (10 seconden)
connect <addr>    - Connect direct naar MAC address (bijv: connect aa:bb:cc:dd:ee:ff)
solace            - Probeer automatisch Solace Pro 2 te vinden en connecten
disconnect        - Disconnect alle verbonden devices
status            - Toon complete connection status

SOLACE PRO 2 CONTROL COMMANDS (wanneer verbonden):
--------------------------------------------------
position <0-100>  - Set position (0=one end, 100=other end)
oscillate <0-20>  - Set oscillation/thrusting speed (0=stop, 20=max)
stroke <min> <max> <thrust> - Set stroke range and thrusting level
preset <0-100>    - Move to preset position (same as position)
stop              - Stop all movement

TEST COMMANDS:
--------------
demo              - Volledige geautomatiseerde demo sequence
test stroke       - Test stroke patterns (gentle/medium/intense)
test positions    - Test alle posities 0-100 in stappen
test oscillate    - Test oscillation speeds 0-20
test wave         - Vloeiende sine wave motion met variabele intensity
test patterns     - Test verschillende pattern combinaties

INFO COMMANDS:
--------------
devices           - Lijst van alle ontdekte BLE devices
nunchuk           - Toon huidige nunchuk status en waardes
help              - Toon alle beschikbare commando's

3. NUNCHUK REAL-TIME CONTROL
----------------------------
✅ Y-joystick → Solace position (0-100, omgekeerd voor natuurlijke besturing)
✅ X-joystick → Oscillation intensity (0-20 Lovense range)
✅ Automatische rate limiting (10Hz max voor Solace Pro 2)
✅ Deadzone voor X-joystick om accidentele oscillation te voorkomen
✅ Live feedback op display met position en intensity waardes

4. PROTOCOL IMPLEMENTATIE DETAILS
---------------------------------
Gebaseerd op reverse-engineered community documentatie:

PRIMARY UUIDs (Lovense Standard):
- Service:      6e400001-b5a3-f393-e0a9-e50e24dcca9e
- Write Char:   6e400002-b5a3-f393-e0a9-e50e24dcca9e
- Read Char:    6e400003-b5a3-f393-e0a9-e50e24dcca9e

FALLBACK UUIDs (Alternative Lovense):
- Service:      53300001-0023-4bd4-bbd5-a6920e4c5653
- Write Char:   53300002-0023-4bd4-bbd5-a6920e4c5653
- Read Char:    53300003-0023-4bd4-bbd5-a6920e4c5653

COMMANDO PROTOCOL (string-based):
- Position:     "Preset:POSITION;" (position 0-100)
- Oscillation:  "Oscillate:SPEED;" (speed 0-20)
- Function:     "Function:MIN-MAX,Thrusting:LEVEL;" (stroke range + thrusting)
- Rate limiting: Max 10Hz (100ms interval) voor device stability

5. DEBUGGING & MONITORING
-------------------------
✅ Uitgebreide Serial logging voor alle BLE events
✅ Real-time connection status monitoring
✅ Device discovery logging met Lovense herkenning (LVS- prefixes)
✅ Command success/failure feedback
✅ Automatic reconnection attempts voor Nunchuk

GEBRUIKSINSTRUCTIES
===================

STAP 1: HARDWARE SETUP
----------------------
1. Sluit Nintendo Nunchuk aan op I2C (SDA=21, SCL=22)
2. Upload de code naar TTGO T-Display V1.1
3. Zet Solace Pro 2 aan en zorg dat hij in pairing mode staat

STAP 2: EERSTE OPSTART
----------------------
1. Open Serial Monitor (115200 baud)
2. Reset de ESP32
3. Wacht op "[SETUP] Solace Pro 2 Test ready!" bericht
4. Type 'help' voor alle beschikbare commando's

STAP 3: SOLACE PRO 2 VERBINDING
-------------------------------
Via Serial Monitor:
1. Type 'scan' om te zoeken naar Lovense devices
2. Type 'solace' om automatisch te connecten
3. Type 'status' om verbinding te controleren

Via Display Interface:
1. Gebruik Nunchuk joystick Y om tussen Keon/Solace Pro 2 te navigeren
2. Druk Z knop of rechter TTGO knop om connectie popup te openen
3. Kies 'Ja' om te verbinden

STAP 4: TESTEN
--------------
Via Serial Monitor (aanbevolen voor uitgebreid testen):
- Type 'demo' voor volledige geautomatiseerde test
- Type 'test stroke' voor stroke patronen
- Type 'position 75' voor handmatige positie besturing
- Type 'test wave' voor vloeiende beweging

Via Nunchuk (real-time besturing):
- Y-joystick omhoog/omlaag = positie
- X-joystick links/rechts = oscillation intensity
- C knop = terug naar menu

TECHNICAL IMPLEMENTATION DETAILS
================================

BLE DEVICE SCANNING:
-------------------
- Actieve scan gedurende 8-10 seconden
- Automatische herkenning via device names ("LVS-", "Solace", etc.)
- Service UUID matching voor Lovense devices
- Callback-based device discovery met duplicate filtering

CONNECTION MANAGEMENT:
---------------------
- Multi-step connection process: scan → connect → service discovery → characteristic mapping
- Fallback UUID support voor verschillende Lovense device variants
- Proper error handling en cleanup bij connection failures
- Notification enabling voor status feedback

COMMAND PROTOCOL:
----------------
- String-based commands volgens reverse-engineered Lovense protocol
- WriteWithoutResponse voor optimale performance
- Rate limiting (100ms minimum interval) om device buffer te respecteren
- Constrain values naar correct ranges (0-100 position, 0-20 oscillation)

NUNCHUK INTEGRATION:
-------------------
- I2C communicatie op pinnen 21/22
- Automatic reconnection bij connection loss
- Deadzone implementatie voor accidentele input preventie
- Real-time mapping naar Solace Pro 2 coordinates

TROUBLESHOOTING
===============

SOLACE PRO 2 WORDT NIET GEVONDEN:
---------------------------------
1. Controleer of Solace Pro 2 in pairing mode staat 
2. Probeer power cycle van de Solace Pro 2
3. Type 'scan' in Serial Monitor om alle devices te zien
4. Zoek naar devices met "LVS-" prefix of "Solace" in naam
5. Gebruik 'connect <MAC address>' voor directe verbinding

VERBINDING LUKT NIET:
--------------------
1. Controleer Serial Monitor voor error berichten
2. Zorg dat device niet al verbonden is met Lovense Remote app
3. Probeer disconnect en opnieuw connecten
4. Reset ESP32 en probeer opnieuw

NUNCHUK WERKT NIET:
------------------
1. Controleer I2C bekabeling (SDA=21, SCL=22)
2. Serial Monitor toont Nunchuk status bij startup
3. Type 'nunchuk' om huidige waardes te zien
4. Automatische reconnection probeert elke 2 seconden

COMMANDO'S WERKEN NIET:
----------------------
1. Type 'status' om verbinding te controleren
2. Solace Pro 2 moet connected zijn voordat commando's werken
3. Controleer Serial Monitor voor command feedback
4. Respecteer rate limiting (niet te snel commando's sturen)

SERIAL COMMAND VOORBEELDEN
==========================

BASIC TESTING SEQUENCE:
-----------------------
1. help                    (toon alle commando's)
2. scan                    (zoek naar devices)
3. solace                  (verbind met Solace Pro 2)
4. status                  (controleer verbinding)
5. demo                    (run complete test)

HANDMATIGE BESTURING:
--------------------
position 0         (naar ene kant)
position 100       (naar andere kant)
position 50        (naar midden)
oscillate 5        (zachte oscillation)
oscillate 15       (sterke oscillation)
stop               (stop alle beweging)

STROKE RANGE BESTURING:
----------------------
stroke 10 90 8     (brede stroke, medium thrusting)
stroke 30 70 12    (smallere stroke, sterke thrusting)
stroke 20 80 3     (brede stroke, zachte thrusting)

GEAUTOMATISEERDE TESTS:
----------------------
test positions     (test alle posities 0-100)
test oscillate     (test oscillation speeds 0-20)
test stroke        (test stroke patronen)
test wave          (vloeiende sine wave beweging)
test patterns      (verschillende pattern combinaties)

MONITORING:
----------
devices            (lijst alle gevonden BLE devices)
status             (complete system status)
nunchuk            (nunchuk waardes en status)

CODE STRUCTUUR
==============

MAIN COMPONENTS:
---------------
- BLE Management (scanning, connecting, Lovense protocol)
- UI State Machine (menu, popup, Solace display)
- Input Handling (nunchuk, buttons)
- Serial Command Interface
- Test Functions (demo, stroke patterns, oscillation tests)
- Display Drawing (menu, status, live feedback)

KEY FUNCTIONS:
-------------
scanForLovenseDevices()      - BLE device scanning met Lovense herkenning
connectToLovenseDevice()     - Multi-step connection process
sendSolacePositionCommand()  - Position command (0-100)
sendSolaceOscillationCommand() - Oscillation command (0-20)
sendSolaceFunctionCommand()  - Stroke function command
handleSerialCommands()       - Complete serial interface
runSolaceDemo()             - Geautomatiseerde test sequence
testSolaceWaveMotion()      - Sine wave movement pattern

PROTOCOL CONSTANTS:
------------------
Alle UUIDs en commando strings zoals gedocumenteerd in:
- solace_pro_2_api_notes.txt
- solace_pro_ble_intiface_buttplug.txt
- Community reverse-engineering documenten

SAFETY CONSIDERATIONS
====================

HARDWARE SAFETY:
----------------
- Rate limiting voorkomt device overload
- Proper disconnect bij menu return
- Stop commando voor emergency stop
- Constrain functies voorkomen invalid values

SOFTWARE SAFETY:
----------------
- Null pointer checks voor alle BLE operations
- Connection state validation voor alle commando's
- Error handling en recovery
- Automatic cleanup bij disconnection

TESTING SAFETY:
---------------
- Start altijd met lage intensiteiten
- Test sequences bouwen langzaam op
- Stop commando's ingebouwd in alle test functies
- Manual override mogelijk via C knop of 'stop' commando

SOLACE PRO 2 SPECIFIEKE VERSCHILLEN MET KEON
===========================================

PROTOCOL VERSCHILLEN:
--------------------
- Keon: 2-byte binary protocol [position, speed] (0-99 range)
- Solace: String-based protocol "Command:Value;" format
- Keon: 20Hz rate limiting (50ms interval)
- Solace: 10Hz rate limiting (100ms interval)

COMMAND VERSCHILLEN:
-------------------
- Keon: Direct position/speed commands
- Solace: Position + Oscillation + Function commands
- Keon: Speed range 0-99
- Solace: Oscillation range 0-20

UI VERSCHILLEN:
--------------
- Solace: Purple/magenta theming (signature Lovense colors)
- Solace: Dual track visualization
- Solace: Intensity bar voor oscillation level
- Solace: Different animation speed (slightly faster)

VERSION HISTORY
===============
v1.0 (2025-09-17):
- Basis TTGO interface met menu en nunchuk (aangepast van Keon versie)
- Simulated connection functions
- Solace Pro 2 themed visual feedback

v2.0 (2025-09-17):
- Complete BLE implementatie met NimBLE
- Lovense protocol support (reverse-engineered)
- Real-time Solace Pro 2 besturing
- Uitgebreide serial command interface
- Geautomatiseerde test functions
- Comprehensive debugging features

BRONNEN & REFERENTIES
====================
- Lovense Standard API: https://developer.lovense.com/docs/standard-solutions/standard-api
- Solace Pro 2 Getting Started: https://www.lovense.com/guide/solace-pro
- User Manual: https://cdn.lovense.com/UploadFiles/web/productpage/solacePro/SolacePro_User_Manual.pdf
- Intiface Lovense docs: https://docs.intiface.com/docs/intiface-central/brands/lovense/
- Community BLE reverse engineering: EroScripts forums, Buttplug project issues
- GitHub Intiface releases: Solace Pro Linear Movement Support v2.6.4+

BELANGRIJKE DIFFERENCES MET OFFICIËLE API
=========================================
Deze implementatie gebruikt REVERSE-ENGINEERED BLE protocol:
- Niet officieel ondersteund door Lovense
- Gebaseerd op community research en Intiface/Buttplug implementaties
- Voor officiële ondersteuning gebruik Lovense Remote app + LAN API
- Protocol kan veranderen met firmware updates
- Gebruik op eigen risico

ALTERNATIEVE ROUTES:
-------------------
1. Lovense Remote app + LAN API (officieel, gedocumenteerd)
2. Intiface/Buttplug stack (community, stabiel)  
3. Deze directe BLE implementatie (experimenteel)

CONTACT & SUPPORT
================
Voor vragen of problemen, controleer:
1. Serial Monitor output voor debug informatie
2. Troubleshooting sectie hierboven
3. Originale documentatie bestanden in project folder
4. Community forums (EroScripts, Buttplug Discord)

LET OP: Dit is experimentele software gebaseerd op reverse-engineered protocols.
Gebruik altijd de laagste intensiteit eerst en test zorgvuldig!

=== EINDE HANDLEIDING ===