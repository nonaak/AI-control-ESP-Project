# ‚ö†Ô∏è KEON PARAMETER VERWARRING - LEES DIT GOED!

## üö® KRITIEKE NOTITIE: STOP MET DEZE FOUT!

Er is een **cruciale verwarring** over Keon parameters die **ELKE KEER VERKEERD** gaat:

---

## üìä KEON PROTOCOL - DE WAARHEID

### **Keon Command Structure:**
```cpp
uint8_t cmd[5] = {0x04, 0x00, POSITION, 0x00, SPEED};
```

### **Parameter 1: POSITION (0-99)**
- **WAT HET IS:** Doelpositie van de sleeve
- 0 = Helemaal beneden
- 99 = Helemaal boven
- 50 = Midden

### **Parameter 2: SPEED (0-99)**
- **WAT HET IS:** Hoe SNEL de motor naar de positie gaat
- **DIT IS G√â√âN "strokes per minuut"!**
- **DIT IS G√â√âN "snelheid van het neuken"!**
- **DIT IS:** Motor power/snelheid naar doelpositie
- Speed 99 = Motor gaat full power/snel naar positie
- Speed 20 = Motor gaat traag/zacht naar positie

---

## ‚ùå DE VERWARRING (STOP HIERMEE!)

### **FOUT GEDACHT:**
```
"Speed parameter = aantal strokes per minuut"
"Speed 99 = 99 strokes/min"
"Speed 20 = 20 strokes/min"
```

### **DIT IS FOUT! ‚ùå**

---

## ‚úÖ HOE HET ECHT WERKT

### **JE WILT:**
```
Level 0: LANGZAME KORTE strokes
Level 7: SNELLE LANGE strokes
```

### **HOE JE DIT BEREIKT:**

**1. STROKE RANGE (via POSITION parameter)**
```
Level 0: Kleine range (bijv. 40-60) = KORTE strokes
Level 7: Grote range (bijv. 0-99) = LANGE strokes
```

**Code:**
```cpp
uint8_t strokeRange = 20 + ((g_speedStep * 79) / 7);  // 20 @ L0, 99 @ L7
uint8_t centerPos = 50;
uint8_t targetPos = keonDirection ? 
    (centerPos + strokeRange/2) :  // Omhoog
    (centerPos - strokeRange/2);   // Omlaag
```

**2. STROKE SNELHEID (via TIMING, niet speed parameter!)**
```
Level 0: Toggle elke 1200ms = LANGZAAM
Level 7: Toggle elke 400ms = SNEL
```

**Code:**
```cpp
uint32_t syncInterval = 1200 - ((g_speedStep * 800) / 7);
if ((now - lastStroke) < syncInterval) return;  // Wacht
```

**3. MOTOR POWER (speed parameter = ALTIJD MAX)**
```cpp
uint8_t keonSpeed = 99;  // ALTIJD 99 voor volle kracht!
```

---

## üéØ CORRECTE IMPLEMENTATIE

```cpp
void keonIndependentTick() {
  static bool direction = false;
  static uint32_t lastStroke = 0;
  
  extern uint8_t g_speedStep;
  uint32_t now = millis();
  
  // 1. RANGE (kort bij L0, lang bij L7)
  uint8_t strokeRange = 20 + ((g_speedStep * 79) / 7);
  
  // 2. TIMING (langzaam bij L0, snel bij L7)
  uint32_t interval = 1200 - ((g_speedStep * 800) / 7);
  if ((now - lastStroke) < interval) return;
  
  // 3. POSITIE berekenen
  direction = !direction;
  uint8_t targetPos = direction ? 
      (50 + strokeRange/2) : 
      (50 - strokeRange/2);
  
  // 4. SPEED = ALTIJD 99!
  uint8_t speed = 99;
  
  // 5. STUUR COMMANDO
  keonMove(targetPos, speed);
  lastStroke = now;
}
```

---

## üìã RESULTAAT PER LEVEL

```
Level 0:
  - Range: 20 (positie 40-60) = KORTE strokes
  - Interval: 1200ms = LANGZAAM toggle
  - Speed: 99 = Motor gaat snel naar positie
  - Resultaat: Korte, langzame strokes ‚úÖ

Level 7:
  - Range: 99 (positie 0-99) = LANGE strokes
  - Interval: 400ms = SNEL toggle
  - Speed: 99 = Motor gaat snel naar positie
  - Resultaat: Lange, snelle strokes ‚úÖ
```

---

## üö® VEELVOORKOMENDE FOUTEN

### **FOUT 1: Speed variabel maken**
```cpp
uint8_t keonSpeed = 20 + ((g_speedStep * 79) / 7);  // ‚ùå FOUT!
```
**Probleem:** Bij lage levels gaat motor traag ‚Üí Keon blijft achter
**Oplossing:** Speed ALTIJD 99!

### **FOUT 2: Range vast laten**
```cpp
uint8_t targetPos = direction ? 99 : 0;  // ‚ùå FOUT bij alle levels!
```
**Probleem:** Altijd volle strokes, ongeacht level
**Oplossing:** Range variabel maken!

### **FOUT 3: Snelheid in speed parameter stoppen**
```cpp
// Proberen "snelle strokes" te krijgen via speed parameter
uint8_t keonSpeed = speedLevel * 10;  // ‚ùå FOUT!
```
**Probleem:** Speed ‚â† strokes/min, speed = motor power
**Oplossing:** Snelheid via INTERVAL, niet via speed parameter!

---

## üí° ANALOGIE

**Stel je een auto voor:**

**Speed parameter = Gaspedaal**
- Speed 99 = Gaspedaal ingedrukt, auto gaat snel naar bestemming
- Speed 20 = Gaspedaal lichtjes, auto gaat traag naar bestemming

**Position parameter = Bestemming**
- Position 99 = Rij naar stad A
- Position 0 = Rij naar stad B

**Interval timing = Hoe vaak je van bestemming wisselt**
- 1200ms = Elke 1.2 seconde verander je van bestemming (langzaam)
- 400ms = Elke 0.4 seconde verander je van bestemming (snel)

**JE WILT:**
- Gaspedaal altijd ingedrukt (speed 99)
- Afstand tussen steden variabel (range)
- Hoe vaak je wisselt variabel (interval)

---

## ‚úÖ CHECKLIST VOOR NIEUWE CODE

Bij elke Keon implementatie, check:

- [ ] Speed parameter = 99 (vast)?
- [ ] Stroke range = variabel op basis van level?
- [ ] Timing interval = variabel op basis van level?
- [ ] Positie berekend met center ¬± (range/2)?
- [ ] Direction toggle bij elke interval?

**ALS DEZE 5 CHECKS ‚úÖ ZIJN ‚Üí CODE IS GOED**
**ALS √â√âN CHECK ‚ùå IS ‚Üí CODE IS FOUT**

---

## üéØ SAMENVATTING

**ONTHOUD DIT:**

1. **Speed parameter ‚â† stroke snelheid!**
2. **Speed = motor power naar positie**
3. **Stroke snelheid = timing tussen toggles**
4. **Stroke lengte = position range**
5. **ALTIJD: speed = 99, varieer range + interval!**

**PRINT DIT UIT EN HANG HET OP JE BUREAU!**

---

**Gemaakt:** 16 November 2025
**Reden:** Te vaak dezelfde fout gemaakt
**Doel:** NOOIT MEER DEZE FOUT MAKEN!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
