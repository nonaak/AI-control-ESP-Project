/*
  PLAYBACK SCREEN V2 - Herontworpen voor duidelijke visualisatie
  
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Layout (480x320):
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â–¶ sessie_20241124.anl                              125.3s / 1847.2s    â”‚  Y: 0-28
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                    â”‚                                                    â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â™¥ HR ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    â”‚
  â”‚   â”‚          â”‚     â”‚  ğŸŒ¡ Temp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
  â”‚   â”‚    4     â”‚     â”‚  âš¡ GSR âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿    â”‚  Y: 28-220
  â”‚   â”‚ VERHOOGD â”‚     â”‚                                                    â”‚
  â”‚   â”‚          â”‚     â”‚  ğŸ“Š LEVEL â–â–‚â–ƒâ–„â–…â–„â–ƒâ–„â–…â–†â–‡â–†â–…â–„â–ƒâ–„â–…â–†â–‡â–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–‚â–ƒâ–„â–…â–†    â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                    â”‚
  â”‚                    â”‚                                                    â”‚
  â”‚   AI: 5 â†’ Jij: 4   â”‚                                                    â”‚
  â”‚   Correctie: -1    â”‚                                                    â”‚
  â”‚                    â”‚                                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ [â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  [-] 100% [+]                   â”‚  Y: 220-250
  â”‚      â–²  â–²     â–²           â–²                                             â”‚
  â”‚      â””â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ Markers                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                                          â”‚
  â”‚  [  STOP  ]    [  PAUZE  ]    [ â—€ -10s ]    [ +10s â–¶ ]    [ AI-ACTIE ]  â”‚  Y: 250-320
  â”‚                                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  X: 0-130 = Level paneel
  X: 130-480 = Grafieken (via body_gfx4 of custom)
*/

#ifndef PLAYBACK_SCREEN_V2_H
#define PLAYBACK_SCREEN_V2_H

#include <Arduino.h>
#include <Arduino_GFX_Library.h>

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                         LAYOUT CONSTANTEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Scherm dimensies
#define PB_SCREEN_W         480
#define PB_SCREEN_H         320

// Titel balk
#define PB_TITLE_H          28
#define PB_TITLE_Y          0

// Level paneel (links)
#define PB_LEVEL_PANEL_X    0
#define PB_LEVEL_PANEL_W    125
#define PB_LEVEL_PANEL_Y    PB_TITLE_H
#define PB_LEVEL_PANEL_H    185

// Grafieken (rechts)
#define PB_GRAPH_X          (PB_LEVEL_PANEL_W + 5)
#define PB_GRAPH_W          (PB_SCREEN_W - PB_GRAPH_X)
#define PB_GRAPH_Y          PB_TITLE_H
#define PB_GRAPH_H          190

// Afspeelbalk
#define PB_PROGRESS_Y       218
#define PB_PROGRESS_H       28
#define PB_PROGRESS_X       5
#define PB_PROGRESS_W       380
#define PB_SPEED_X          (PB_PROGRESS_X + PB_PROGRESS_W + 5)

// Knoppen
#define PB_BUTTON_Y         252
#define PB_BUTTON_H         38
#define PB_BUTTON_W         90
#define PB_BUTTON_SPACING   5

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                         KLEUREN PER STRESS LEVEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Stress level kleuren (van groen naar rood) - gedefinieerd in playback_screen_v2.cpp
extern const uint16_t STRESS_COLORS[8];

// Level labels (kort) - gedefinieerd in playback_screen_v2.cpp
extern const char* STRESS_LABELS_SHORT[8];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                         ANNOTATIE MARKER STRUCTUUR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

struct PlaybackMarker {
  float timestamp;        // Seconden in recording
  int level;              // Stress level (0-7)
  bool isAI;              // true = AI voorspelling, false = user annotatie
  bool isEdge;            // Edge moment marker
};

#define MAX_VISIBLE_MARKERS 50

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                         PLAYBACK SCREEN CLASS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class PlaybackScreenV2 {
public:
  PlaybackScreenV2();
  
  // â”€â”€â”€ Setup â”€â”€â”€
  void begin(Arduino_GFX* gfx);
  
  // â”€â”€â”€ State Updates â”€â”€â”€
  void setFilename(const char* filename);
  void setProgress(float currentTime, float totalTime);
  void setSpeed(float speedPercent);
  void setPaused(bool paused);
  
  // â”€â”€â”€ Level Updates â”€â”€â”€
  void setCurrentLevel(int level);              // Huidig stress level (0-7)
  void setAIPrediction(int aiLevel);            // Wat AI voorspelde
  void setUserAnnotation(int userLevel);        // Wat gebruiker koos
  
  // â”€â”€â”€ Sensor Updates â”€â”€â”€
  void setSensorValues(float hr, float temp, float gsr);
  
  // â”€â”€â”€ Markers â”€â”€â”€
  void clearMarkers();
  void addMarker(float timestamp, int level, bool isAI, bool isEdge = false);
  
  // â”€â”€â”€ Level History (voor level grafiek) â”€â”€â”€
  void pushLevelSample(int level);
  
  // â”€â”€â”€ Drawing â”€â”€â”€
  void drawStaticElements();    // Eenmalig: frame, labels
  void drawDynamicElements();   // Elke frame: levels, progress, sensors
  void drawLevelPanel();        // Level indicator links
  void drawProgressBar();       // Afspeelbalk met markers
  void drawButtons(int selectedIdx);  // Knoppen onderaan
  void drawTitleBar();          // Titel met bestandsnaam en tijd
  void drawLevelGraph();        // Level over tijd grafiek
  
  // â”€â”€â”€ Touch â”€â”€â”€
  int handleTouch(int x, int y);  // Returns: -1=geen hit, 0-4=knop index
  
  // â”€â”€â”€ Encoder Navigatie â”€â”€â”€
  void setSelectedButton(int idx);
  int getSelectedButton() { return selectedButtonIdx; }
  int getButtonCount() { return 5; }  // STOP, PLAY, -10s, +10s, AI-ACTIE
  
private:
  Arduino_GFX* gfx;
  
  // State
  char filename[64];
  float currentTime;
  float totalTime;
  float speed;
  bool isPaused;
  
  // Levels
  int currentLevel;
  int aiPredictedLevel;
  int userAnnotatedLevel;
  
  // Sensors
  float hr, temp, gsr;
  
  // Markers voor afspeelbalk
  PlaybackMarker markers[MAX_VISIBLE_MARKERS];
  int markerCount;
  
  // Level history voor grafiek (laatste 100 samples)
  int8_t levelHistory[100];
  int levelHistoryIdx;
  bool levelHistoryFull;
  
  // UI state
  int selectedButtonIdx;
  bool staticDrawn;
  
  // â”€â”€â”€ Helpers â”€â”€â”€
  uint16_t getLevelColor(int level);
  void drawCenteredText(const char* text, int x, int y, int w, uint16_t color, uint16_t bg);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                         GLOBAL INSTANCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

extern PlaybackScreenV2 playbackScreen;

#endif // PLAYBACK_SCREEN_V2_H
